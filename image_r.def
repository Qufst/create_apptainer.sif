Bootstrap: docker
From: ubuntu:22.04

%post
    # Mettre à jour et installer les dépendances système
    apt-get update && apt-get install -y \
        software-properties-common \
        dirmngr \
        gnupg \
        apt-transport-https \
        ca-certificates \
        curl \
        make \
        gcc \
        g++ \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev \
        libfontconfig1-dev \
        libfreetype6-dev \
        libtiff5-dev \
        libpng-dev \
        zlib1g-dev

    # Ajouter le dépôt CRAN et installer R
    curl -fsSL https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | gpg --dearmor -o /usr/share/keyrings/cran-archive-keyring.gpg
    add-apt-repository "deb [signed-by=/usr/share/keyrings/cran-archive-keyring.gpg] https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
    apt-get update && apt-get install -y r-base=4.4.0-1.2004.0

    # Installer renv
    R -e "install.packages('renv', repos='https://cloud.r-project.org/')"

%environment
    # Définir les variables d'environnement
    export RENV_PATHS_CACHE=/renv/cache

%runscript
    exec "$@"
