Bootstrap: docker
From: alpine:latest

%labels
    AUTHOR Quentin Festor
    VERSION 1.0
    DESCRIPTION "test de cr√©ation de sif pour computo"

%post
    wget -O environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml


    # Download micromamba
    if [ "$RUNNER_OS" == "Linux" ]; then
      wget -qO- https://micromamba.snakepit.net/api/micromamba/linux-64/latest | tar -xvj bin/micromamba --strip-components=1
    else
      wget -qO- https://micromamba.snakepit.net/api/micromamba/osx-64/latest | tar -xvj bin/micromamba
      mv bin/micromamba ./micromamba
    fi

    ./micromamba shell init -s bash -p ~/micromamba
    mkdir -p ~/micromamba/pkgs/
    export MAMBA_ROOT_PREFIX=~/micromamba
    export MAMBA_EXE=$(pwd)/micromamba
    . $MAMBA_ROOT_PREFIX/etc/profile.d/mamba.sh
    ./micromamba create -y -n myenv -f environment.yml


%environment
    eval "$(micromamba shell hook --shell )"
    micromamba activate myenv
%help
    Utilisation : apptainer run image.sif --option
