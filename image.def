Bootstrap: docker
From: alpine:latest

%labels
    AUTHOR Quentin Festor
    VERSION 1.0
    DESCRIPTION "test de crÃ©ation de sif pour computo"

%post
    apk add wget tar bzip2 bash curl
    wget -O environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml
    wget -qO-  https://micromamba.snakepit.net/api/micromamba/linux-64/latest | tar -xvj bin/micromamba
    touch /root/.bashrc
    ./bin/micromamba shell init -s bash -p /opt/conda
    grep -v '[ -z "\$PS1" ] && return' /root/.bashrc  > /opt/conda/bashrc
    apt-get clean autoremove --yes
    rm -rf /var/lib/{apt,dpkg,cache,log}
    source /opt/conda/bashrc
    micromamba create -y -n myenv -f environment.yml


%environment
    /root/.local/bin/micromamba activate myenv
%help
    Utilisation : apptainer run image.sif --option
