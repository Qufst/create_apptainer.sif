Bootstrap: docker
From: alpine:3.17

%help
    Container with Micromamba on Alpine Linux.

%environment
    export PATH=/opt/micromamba/bin:$PATH

%post
    # Installer les dépendances
    apk update && apk add --no-cache \
        bash \
        curl \
        wget \
        ca-certificates \
        bzip2 \
        libstdc++ \
        git && \
        rm -rf /var/cache/apk/*

    # Installer Micromamba
    wget -O opt/environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml
    curl -Ls https://micromamba.snakepit.net/api/micromamba/linux-64/latest | tar -xvj -C /opt/micromamba/bin/ --strip-components=1 bin/micromamba

    # Créer un environnement Micromamba et installer des paquets de base
    /opt/micromamba/bin/micromamba create -y -n myenv -f opt/environment.yml && \
    /opt/micromamba/bin/micromamba clean --all --yes

%runscript
    exec /bin/bash "$@"

%startscript
    exec /bin/bash


