Bootstrap: docker
From: alpine:3.17

%help
    Container with Micromamba on Alpine Linux.

%environment
    export PATH=/opt/micromamba/bin:$PATH

%post
    # Installer les dépendances
    apk update && apk add --no-cache \
        bash \
        curl \
        wget \
        ca-certificates \
        bzip2 \
        libstdc++ \
        git && \
        rm -rf /var/cache/apk/*
    mkdir -p /opt/micromamba/bin/

    # Installer Micromamba
    wget -O opt/environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml
    curl -Ls https://micro.mamba.pm/install.sh | bash -s -- -b /opt/micromamba

    # Créer un environnement Micromamba et installer des paquets de base
    /opt/micromamba/bin/micromamba create -y -n myenv -f opt/environment.yml && \
    /opt/micromamba/bin/micromamba clean --all --yes

%runscript
    exec /bin/bash "$@"

%startscript
    exec /bin/bash




