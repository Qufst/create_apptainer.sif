Bootstrap: docker
From: mambaorg/micromamba:alpine


%environment
    micromamba install -y -f environment.yml
    micromamba activate myenv

%post
    apk add --no-cache perl wget tar git
    git config --global user.email "quentin.festor@etu.umontpellier.com"
    git config --global user.name "quarto-github-actions"
    # Télécharger et installer Quarto via un script d'installation direct
    wget https://github.com/quarto-dev/quarto-cli/releases/download/v1.4.555/quarto-1.4.555-linux-amd64.tar.gz

    echo "quarto.tar installed"
    find / -name "quarto-1.4.555-linux-amd64.tar.gz" 2>/dev/null
    tar -xzvf /quarto-1.4.555-linux-amd64.tar.gz
    

    echo "quarto untared"
    ls -l


    ./quarto-1.4.555-linux-amd64/install.sh

    echo "quarto.sh"

    quarto --version

    rm quarto-1.4.555-linux-amd64.tar.gz
    rm -rf quarto-1.4.555-linux-amd64
    
    quarto install tinytex --update-path

    echo "tinytex install finished"
        
    quarto add --no-prompt computorg/computo-quarto-extension

%runscript
    quarto publish index.qmd
