Bootstrap: docker
From: continuumio/miniconda3
   
%files
    environment.yml
   
%environment
    export PATH="/opt/conda/envs/$ENV_NAME/bin:$PATH"
    . /opt/conda/etc/profile.d/conda.sh
    conda activate $ENV_NAME
   
%post
    echo ". /opt/conda/etc/profile.d/conda.sh" >> $APPTAINER_ENVIRONMENT
    echo "conda activate myenv" >> $APPTAINER_ENVIRONMENT
    echo "export PATH=/opt/conda/envs/$ENV_NAME/bin:\$PATH" >> $APPTAINER_ENVIRONMENT
   
    . /opt/conda/etc/profile.d/conda.sh
    conda env create -f environment.yml -p /opt/conda/envs/myenv
    conda clean --all
   
%runscript  
    exec "$@"
