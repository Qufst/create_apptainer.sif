Bootstrap: docker
From: alpine:latest

%labels
    AUTHOR Quentin Festor
    VERSION 1.0
    DESCRIPTION "test de création de sif pour computo"

%post
    wget -O environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml


    # Download micromamba
    wget -O /usr/local/bin/micromamba https://micro.mamba.pm/api/micromamba/linux-64/latest

    ls -a
    ls -a /usr/local/bin/micromamba

    # Rendre Micromamba exécutable
    chmod +x /usr/local/bin/micromamba

    # Créer un répertoire pour l'environnement conda
    mkdir -p /opt/mamba

    # Initialiser Micromamba
    /usr/local/bin/micromamba shell init -s bash -p /opt/mamba

    # Ajouter Micromamba au PATH
    export PATH=/opt/mamba/bin:$PATH

    # Créer l'environnement conda à partir du fichier environment.yml
    micromamba create -y -f /environment.yml -p /opt/mamba
    
%environment
    eval "$(micromamba shell hook --shell )"
    micromamba activate myenv
micromamba create -y -n myenv -f environment.yml
%help
    Utilisation : apptainer run image.sif --option
