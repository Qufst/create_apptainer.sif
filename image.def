Bootstrap: docker
From: mambaorg/micromamba:alpine


%environment
    micromamba install -y -f environment.yml
    micromamba activate myenv

%post
    apk add --no-cache perl wget tar git
    git config --global user.email "quentin.festor@etu.umontpellier.com"
    git config --global user.name "quarto-github-actions"
    wget -qO- https://quarto.org/download/latest/quarto-linux-amd64.tar.gz | tar -xvz -C $HOME
    
    ls 
    echo "ls finished"
    find $HOME -name "*quarto*" 2>/dev/null
    echo "quarto installation finished"
    find $(micromamba info --base)/envs/myenv -name "*quarto*" 2>/dev/null
    echo "find conda quarto"
    find / -name "*quarto*" 2>/dev/null

    quarto install tinytex --update-path

    echo "tinytex install finished"
        
    $HOME/quarto/bin/quarto add --no-prompt computorg/computo-quarto-extension

%runscript
    $HOME/quarto/bin/quarto publish index.qmd
