Bootstrap: docker
From: mambaorg/micromamba:alpine

%help
    Container with micromamba on Alpine Linux.

%files
    environment.yml /environment.yml

%post
    eval "$(micromamba shell hook -s posix)"
    micromamba activate base

    micromamba config --add channels conda-forge
    micromamba config --add channels defaults

    micromamba create -y -f /environment.yml -n myenv


    echo 'eval "$(micromamba shell hook -s posix)"' >> /etc/profile
    echo 'micromamba activate myenv' >> /etc/profile

    apk add --no-cache wget tar gdb make gcc g++ cmake file
    micromamba install -y -n myenv nodejs

    cd /opt
    git clone https://github.com/quarto-dev/quarto-cli.git
    cd quarto-cli
    npm install
    npm run build

    # Move the built binary to /opt/quarto
    mkdir -p /opt/quarto/bin
    cp ./dist/quarto /opt/quarto/bin/quarto

    # Add Quarto to PATH
    echo 'export PATH=/opt/quarto/bin:$PATH' >> /etc/profile
%environment
    eval "$(micromamba shell hook -s posix)"
    micromamba activate myenv
    export PATH=/opt/quarto/bin:$PATH
%runscript
    python
    exec "$@"





