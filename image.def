Bootstrap: docker
From: mambaorg/micromamba:alpine

%help
    Container with micromamba on Alpine Linux.

%files
    environment.yml /environment.yml

%post
    eval "$(micromamba shell hook -s posix)"
    micromamba activate base

    micromamba create -y -f /environment.yml -n myenv


    echo 'eval "$(micromamba shell hook -s posix)"' >> /etc/profile
    echo 'micromamba activate myenv' >> /etc/profile

    apk add --no-cache wget tar gdb file

    QUARTO_VERSION=1.5.54
    mkdir -p /opt/quarto
    wget -qO- https://github.com/quarto-dev/quarto-cli/releases/download/v${QUARTO_VERSION}/quarto-${QUARTO_VERSION}-linux-amd64.tar.gz | tar -xz -C /opt/quarto --strip-components=1

    # Add Quarto to PATH
    echo 'export PATH=/opt/quarto/bin:$PATH' >> /etc/profile

    # Install Deno
    DENO_VERSION=v1.27.1
    wget -qO- https://github.com/denoland/deno/releases/download/${DENO_VERSION}/deno-x86_64-unknown-linux-gnu.zip -O deno.zip
    unzip deno.zip -d /usr/local/bin
    rm deno.zip

    # Add Deno to PATH
    echo 'export PATH=/usr/local/bin:$PATH' >> /etc/profile
%environment
    eval "$(micromamba shell hook -s posix)"
    micromamba activate myenv
    export PATH=/opt/quarto/bin:$PATH
%runscript
    python
    exec "$@"





