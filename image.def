Bootstrap: docker
From: alpine:3.17

%help
    Container with Micromamba on Alpine Linux.

%environment
    export PATH=/opt/micromamba/bin:$PATH

%post
    # Installer les dépendances
    apk update && apk add --no-cache \
        bash \
        curl \
        wget \
        ca-certificates \
        bzip2 \
        libstdc++ \
        git && \
        rm -rf /var/cache/apk/*

    # Installer Micromamba
    wget -O opt/environment.yml https://raw.githubusercontent.com/Qufst/create_apptainer.sif/main/environment.yml
    wget -O miniconda.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    mkdir -p /opt/miniconda
    bash miniconda.sh -s -p /opt/miniconda
    rm miniconda.sh
    export PATH=/opt/miniconda/bin:$PATH
    conda install -y -c conda-forge micromamba

    # Créer un environnement Micromamba et installer des paquets de base
    micromamba create -y -n myenv -f opt/environment.yml && \
    micromamba clean --all --yes

%runscript
    exec /bin/bash "$@"

%startscript
    exec /bin/bash




